/*!CK:3308683037!*//*1392763062,178175255*/

if (self.CavalryLogger) { CavalryLogger.start_js(["BzKt+"]); }

__d("ComposerXLinkScraperAttachment",["ComposerXAttachment","ComposerXAttachmentUtils","ComposerXController","ComposerXDragDrop","ComposerXPrivacyWidgetTags","DOM","Event","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){for(var r in g)if(g.hasOwnProperty(r))t[r]=g[r];var s=g===null?null:g.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=g;function t(u,v,w){"use strict";g.call(this);this._root=u;this._tagger=v;this._config=w;if(w.plus_version)this._initDragDropDialog(w.dragdropPhotoDialog);}t.prototype.getRoot=function(){"use strict";return this._root;};t.prototype.initWithComponents=function(){"use strict";if(!this._config.canCreateShare)this._switchToAttachmentWithoutLinkShare();var u=this.getComponent('maininput');h.initMentions(u,this._config.mentionsPlaceholder);this._tagger.init(this);this._privacyWidgetTags=new k(this);var v=l.scry(this._root,"._9s");if(v.length>0){var w=v[0];this._removeListener=m.listen(w,'click',this._switchToAttachmentWithoutLinkShare.bind(this));}if(this._config.plus_version)this._dragdrop=new j(this._root,this._composerID,this._config.targetID,this._onDragDropPhoto.bind(this));};t.prototype.cleanup=function(){"use strict";this._tagger.cleanup();if(this._privacyWidgetTags){this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;}if(this._removeListener){this._removeListener.remove();this._removeListener=null;}if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}};t.prototype.reset=function(){"use strict";this._tagger.reset();};t.prototype.canSwitchAway=function(){"use strict";return !n.byClass(this._root,'async_saving');};t.prototype._switchToAttachmentWithoutLinkShare=function(){"use strict";i.getAttachment(this._root,this._config.removeEndpoint);};t.prototype._initDragDropDialog=function(u){"use strict";this._dragdropPhotoDialog=u;u.subscribe('button',this._onConfirmDragDropPhoto.bind(this));};t.prototype._onDragDropPhoto=function(u){"use strict";this._uploadPhotoCallback=u;this._dragdropPhotoDialog.show();};t.prototype._onConfirmDragDropPhoto=function(){"use strict";this._uploadPhotoCallback&&this._uploadPhotoCallback();this._dragdropPhotoDialog.hide();};o(t.prototype,{_privacyWidgetTags:null,_removeListener:null,_uploadPhotoCallback:null,_dragdrop:null,attachmentClassName:"_4j"});e.exports=t;});
__d("ComposerXMediaUploadProgressBarAttachment",["Button","CSS","ComposerXAttachment","ComposerXAttachmentUtils","ComposerXController","ComposerXMediaUploadHandler","ComposerXPrivacyWidgetTags","DOM","ErrorDialog","Event","Form","PagesBanzaiLogger","Parent","React","Run","SubscriptionsHandler","VideoUploadProcessingDialog.react","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z={};for(var aa in i)if(i.hasOwnProperty(aa))ca[aa]=i[aa];var ba=i===null?null:i.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=i;function ca(da){"use strict";i.call(this);this._root=da.root;this._fileInput=da.file_input;this._fileInputButton=da.file_input_button;this._fileInputText=da.file_input_text;this._trailerCheckbox=da.trailer_checkbox;this._trailerCheckboxContainer=da.trailer_checkbox_container;this._progressBar=da.progress_bar;this._tagger=da.tagger;this._submitButton=da.submit_button;this._config=da.config;this.attachmentClassName="_92";this._processingDialogContainer=da.processing_dialog_container;}ca.prototype.getRoot=function(){"use strict";return this._root;};ca.prototype.initWithComponents=function(){"use strict";z[this._composerID]=this;u.onBeforeUnload(function(){if(this._fileInput.getValue())return "You haven't finished your post yet. Do you want to leave without finishing?";}.bind(this));u.onLeave(this._abandonUpload.bind(this));u.onUnload(this._abandonUpload.bind(this));this._subscriptionsHandler=new v();this._subscriptionsHandler.addSubscriptions(this._fileInput.subscribe('change',this._handleFileChange.bind(this)),p.listen(this._root,'submit',this._handleSubmit.bind(this),p.Priority.URGENT),this._config.videoUploader.subscribe('upload-finished',this._handleVideoUploadFinished.bind(this)),this._config.videoUploader.subscribe('upload-failed',this._handleVideoUploadFailed.bind(this)),this._config.videoUploader.subscribe('post-finished',this._handleVideoPostFinished.bind(this)),this._config.videoUploader.subscribe('post-failed',this._handleVideoPostFailed.bind(this)));j.initMentions(this.getComponent('maininput'),this._config.mentionsPlaceholder);this._tagger.init(this);this._privacyWidgetTags=new m(this);this._hasSelected=false;this._root.action=this._config.photoEndpoint;};ca.prototype.cleanup=function(){"use strict";this._tagger.cleanup();this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._subscriptionsHandler.release();delete z[this._composerID];};ca.prototype.reset=function(){"use strict";this._tagger.reset();this._resetState();};ca.prototype.canSwitchAway=function(){"use strict";return !s.byClass(this._root,'async_saving')&&!this._config.videoUploader.isSessionInProgress();};ca.prototype._abandonUpload=function(){"use strict";if(this._config.videoUploader.isSessionInProgress())this._config.videoUploader.abandon();};ca.prototype._handleFileChange=function(){"use strict";g.setEnabled(this._submitButton,!!this._fileInput.getValue());n.setContent(this._fileInputText,this._fileInput.getValue().split('\\').pop());if(this._trailerCheckboxContainer){h.conditionClass(this._trailerCheckboxContainer,'hidden_elem',!l.isVideoFile(this._fileInput));this._trailerCheckbox.checked=false;}var da=this._config.pageSelectLoggingData;if(da&&!this._hasSelected&&this._fileInput.getValue()){this._hasSelected=true;r.logData(da,null);}};ca.prototype._handleSubmit=function(){"use strict";if(!l.isVideoFile(this._fileInput))return;g.setEnabled(this._submitButton,false);g.setEnabled(this._fileInputButton,false);var da=this._fileInput.getInput();da.name='video';this._config.videoUploader.upload(da);h.addClass(this._root,"_4_8");return false;};ca.prototype._handleVideoUploadFinished=function(){"use strict";var da=q.serialize(this._root);this._config.videoUploader.post(da);};ca.prototype._handleVideoUploadFailed=function(event,da){"use strict";if(da)o.show(da.error_summary,da.error_description);this._resetState();};ca.prototype._handleVideoPostFinished=function(event,da){"use strict";t.renderComponent(w({videoID:da.video_id,show:true}),this._processingDialogContainer);k.reset(this._root);};ca.prototype._handleVideoPostFailed=function(event,da){"use strict";if(da)o.show(da.error_summary,da.error_description);this._resetState();};ca.prototype._resetState=function(){"use strict";this._progressBar.reset();this._fileInput.clear();this._fileInput.getInput().name='file1';this._config.videoUploader.abandon();n.setContent(this._fileInputText,'');g.setEnabled(this._fileInputButton,true);h.removeClass(this._root,"_4_8");h.hide(this._trailerCheckboxContainer);};e.exports=ca;});
__d("ComposerXTimelineTagger",["Arbiter","ComposerXPlusTagger","CSS","cx","DOMQuery","Event","Focus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in h)if(h.hasOwnProperty(n))p[n]=h[n];var o=h===null?null:h.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=h;function p(){"use strict";if(h!==null)h.apply(this,arguments);}p.prototype.init=function(q,r){"use strict";o.init.call(this,q);if(!r)r='backdateicon';this._datepicker=this.getTimelineDatepickerComponent(q);this._datepickerIcon=q.getComponent(r);if(this._datepickerIcon&&this._datepicker){this.registerTagger('date',this._datepicker,this._datepickerIcon);var s=k.find(this._datepicker.element,'select.periodMenu.yearMenu');this.setTaggerCallback('date',m.set.bind(null,s));this._subscriptions.push(this._datepicker.instance.subscribe('changed',this._handleDateChanged.bind(this)));this._subscriptions.push(g.subscribe('Datepicker/schedulingPosts',this._handleDateChanged.bind(this)));this._subscriptions.push(g.subscribe('Datepicker/resetSchedulingPosts',function(){this._handleDateChanged('Datepicker/resetSchedulingPosts');this._hideTaggers();}.bind(this)));l.listen(this._datepickerIcon.element,'click',function(){g.inform('Datepicker/clicked');});}g.inform('ComposerXTimelineTagger/init',{composerTimelineTagger:this,datePickerElement:this._datepicker?this._datepicker.element:null,datePickerInstance:this._datepicker?this._datepicker.instance:null},g.BEHAVIOR_STATE);};p.prototype.getTimelineDatepickerComponent=function(q){"use strict";return q.getComponent('backdatepicker');};p.prototype._handleDateChanged=function(event){"use strict";var q=this._datepicker.instance.isSet();i.conditionClass(this._datepickerIcon.element,"_4_na",(q||event=='Datepicker/schedulingPosts')&&event!='Datepicker/resetSchedulingPosts');};e.exports=p;});